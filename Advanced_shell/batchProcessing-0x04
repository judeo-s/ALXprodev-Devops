#!/bin/bash

mkdir -p pokemon_data
> errors.txt

pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

fetch_pokemon() {
  local pokemon=$1
  local attempts=0
  local max_attempts=3
  local timeout=10

  while [ $attempts -lt $max_attempts ]; do
    ((attempts++))
    echo "Attempt $attempts: Fetching data for $pokemon..."

    if timeout "$timeout" curl -s -f "https://pokeapi.co/api/v2/pokemon/$pokemon" -o "pokemon_data/${pokemon}.json"; then
      echo "Saved data to pokemon_data/${pokemon}.json ✅"
      return
    else
      echo "Failed attempt $attempts for $pokemon. Retrying..."
      sleep 2
    fi
  done

  echo "[$(date)] Failed to fetch data for $pokemon after $max_attempts attempts ❌" >> errors.txt
}

export -f fetch_pokemon

for pokemon in "${pokemon_list[@]}"; do
  fetch_pokemon "$pokemon" &
done

wait

echo "✅ All fetch tasks completed."

